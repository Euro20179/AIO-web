const sidebarItems=document.getElementById("sidebar-items"),sidebarIntersected=new Set,sidebarObserver=new IntersectionObserver(e=>{for(let n of e)n.isIntersecting&&n.target.dispatchEvent(new Event("on-screen-appear"))},{root:document.getElementById("sidebar"),rootMargin:"0px",threshold:.1});function clearSidebar(){for(sidebarIntersected.clear();sidebarItems.firstElementChild;)sidebarObserver.unobserve(sidebarItems.firstElementChild),sidebarItems.firstElementChild.remove()}function refreshSidebarItem(e){let n=document.querySelector(`sidebar-entry[data-entry-id="${e.ItemId}"]`);if(n){let r=findUserEntryById(e.ItemId),a=findMetadataById(e.ItemId);if(!r||!a)return;changeSidebarItemData(e,r,a,n)}else renderSidebarItem(e);let t=findMetadataById(e.ItemId);t&&updateSidebarThumbnail(e.ItemId,t?.Thumbnail)}function removeSidebarItem(e){sidebarIntersected.delete(String(e.ItemId)),sidebarItems.querySelector(`[data-entry-id="${e.ItemId}"]`)?.remove()}function updateSidebarEntryContents(e,n,t,r){const a=r.getElementById("sidebar-title"),d=r.getElementById("sidebar-thumbnail");a.value=e.En_Title,a.title=t.Title,d.alt="thumbnail";let i=typeToSymbol(String(e.Type));a.setAttribute("data-type-icon",i),t.ReleaseYear?a.setAttribute("data-release-year",String(t.ReleaseYear)):a.setAttribute("data-release-year","unknown")}function changeSidebarItemData(e,n,t,r){const a=new CustomEvent("data-changed",{detail:{item:e,user:n,meta:t}});r.dispatchEvent(a),r.setAttribute("data-entry-id",String(e.ItemId))}function sidebarEntryOpenMultiple(e,n){clearItems(),selectItem(e,n)}function sidebarEntryOpenOne(e){toggleItem(e)}function updateSidebarThumbnail(e,n){const t=sidebarItems.querySelector(`[data-entry-id="${e}"]`);if(!t)return;let r=t.shadowRoot?.querySelector("img");r.src=n}function renderSidebarItem(e,n=sidebarItems){let t=document.createElement("sidebar-entry");sidebarObserver.observe(t);let r=findMetadataById(e.ItemId),a=findUserEntryById(e.ItemId);if(!a||!r)return t;n.append(t);let d=t.shadowRoot?.querySelector("img");d&&d.addEventListener("click",s=>{s.ctrlKey?sidebarEntryOpenOne(e):sidebarEntryOpenMultiple(e,mode)});let i=t.shadowRoot?.getElementById("sidebar-title");return i&&(i.onchange=function(){i.value&&updateInfoTitle(e.ItemId,i.value)}),t.addEventListener("on-screen-appear",function(s){d.src!==r.Thumbnail&&(d.src=r.Thumbnail)}),t.addEventListener("data-changed",function(s){const l=s,o=l.detail.item,c=l.detail.user,m=l.detail.meta,I=l.detail.events;updateSidebarEntryContents(o,c,m,t.shadowRoot)}),changeSidebarItemData(e,a,r,t),t}function renderSidebar(e){viewAllElem.checked?selectItemList(e,mode):selectItem(e[0],mode),clearSidebar();for(let n=0;n<e.length;n++)renderSidebarItem(e[n],sidebarItems)}
