<!doctype html>
<html lang="en">

<head>
    <script src="/config.js"></script>
    <script src="/ui/ui.js"></script>
    <script src="/js/api.js"></script>
    <script src="/ui/components.js"></script>

    <meta charset="UTF-8" />
    <title>Home</title>
    <link rel="stylesheet" href="/css/colors.css" />
    <link rel="stylesheet" href="/css/general.css" />
    <link rel="manifest" href="/manifest.json" />
    <style>
        body {
            font-family: sans-serif;
        }

        #users-output {
            display: flex;
            flex-direction: column;

            margin-top: 5ch;

            align-items: center;
            gap: 30px;

            div {
                display: flex;
                flex-direction: column;
                width: 100%;

                a {
                    font-size: 1.2em;
                    color: var(--link-color);
                    width: 100%;
                    cursor: pointer;
                    text-transform: capitalize;
                }

                a::after {
                    content: "'s media";
                }
            }
        }

        nav {
            display: grid;
            grid-template-columns: 1fr 1fr;

            > * {
                margin: 0;
            }

            button, a {
                height: 2em;
            }

            div {
                justify-self: end;
            }

            a {
                display: contents;
            }
        }
    </style>
</head>

<body>
    {{ template "www/ui/html-templates/login-dialog.html" }}

    <nav>
        <h2 class="">Welcome</h2>
        <div>
            <button onclick="signinUI()">Login</button>
            <button onclick="setUserAuth(''); alert('Logged out')">Logout</button>
            <a href="/create-account.html"><button>Create account</button></a>
        </div>
    </nav>

    <p>
        Welcome to the AIO LIMAS, basic usage information can be found
        <a href="/usage">here</a>.
    </p>

    <h2 class="">Users</h2>

    <div id="users-output"></div>

    <login-dialog></login-dialog>

    <script>
        const params = new URLSearchParams(document.location.search);
        const uid = params.get("uid");
        if (uid) {
            window.location = `/ui/?uid=${uid}`;
        }

        fetch(`${AIO}/account/list`)
            .then((res) => res.text())
            .then((users) => {
                const usersOutput = document.getElementById("users-output");
                users.split("\n").forEach((user) => {
                    if (!user) return;

                    const [id, name] = user.split(":");
                    const html = `<div style="display: flex; gap: 2ch; flex-direction: row; justify-content: left;"><a href="/ui?uid=${id}">${name}</a></div>`;
                    usersOutput.innerHTML += html;
                });
            });
    </script>
</body>

</html>
